CREATE DATABASE AGENCIA2;
USE AGENCIA2;

CREATE TABLE FUNCIONARIO(
	IDFUNC INT PRIMARY KEY AUTO_INCREMENT,
	NOMEFUNC VARCHAR(50) NOT NULL,
	EMAIL VARCHAR(50) NOT NULL UNIQUE,
	SENHA VARCHAR(100) NOT NULL,
	CPF VARCHAR(11) NOT NULL UNIQUE,
	ID_DEP INT NOT NULL,
	CARGO VARCHAR(30) NOT NULL
	);
	
CREATE TABLE DEPARTAMENTO(
	IDDEP INT PRIMARY KEY AUTO_INCREMENT,
	NOMEDEP VARCHAR(50) NOT NULL,
	ORCAMENTO FLOAT(10,2) NOT NULL,
	ID_GERENTE INT
	);

ALTER TABLE FUNCIONARIO	
ADD CONSTRAINT FK_DEPARTAMENTO_FUNCIONARIO
FOREIGN KEY (ID_DEP)
REFERENCES DEPARTAMENTO(IDDEP);
	
CREATE TABLE SOLICITA(
	IDSOLIC INT PRIMARY KEY AUTO_INCREMENT,
	DATASOLIC DATE NOT NULL,
	ID_FUNC INT NOT NULL,
	ID_AGENCIA INT NOT NULL,
	TIPO ENUM('1', '2', '3') NOT NULL
	);
	
CREATE TABLE AGENCIA(
	IDAGENCIA INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30) NOT NULL,
	CNPJ INT UNIQUE NOT NULL
	);
	
ALTER TABLE SOLICITA
ADD CONSTRAINT FK_FUNCIONARIO_SOLICITA
FOREIGN KEY (ID_FUNC)
REFERENCES FUNCIONARIO(IDFUNC);

ALTER TABLE SOLICITA
ADD CONSTRAINT FK_AGENCIA_SOLICITA
FOREIGN KEY (ID_AGENCIA)
REFERENCES AGENCIA(IDAGENCIA);

CREATE TABLE APROVACAO(
	IDAPROV INT PRIMARY KEY AUTO_INCREMENT,
	ID_SOLIC INT NOT NULL,
	VALOR INT NOT NULL,
	JUSTIFICATIVA VARCHAR(140) NOT NULL,
	APROV ENUM('S','N','P') NOT NULL, /* S = Sim - N = NÃ£o - P = Pendente */
	TIPO ENUM('1', '2', '3') NOT NULL
	);

ALTER TABLE APROVACAO
ADD CONSTRAINT FK_SOLICITA_APROVACAO
FOREIGN KEY (ID_SOLIC)
REFERENCES SOLICITA(IDSOLIC);

CREATE TABLE PASSAGEM(
	IDPASS INT PRIMARY KEY AUTO_INCREMENT,
	NUMIDENT INT NOT NULL UNIQUE,
	ID_APROV INT NOT NULL,
	DTINICIO DATE NOT NULL,
	DTFIM DATE NOT NULL
	);
	
ALTER TABLE PASSAGEM
ADD CONSTRAINT FK_APROVACAO_PASSAGEM
FOREIGN KEY (ID_APROV)
REFERENCES APROVACAO(IDAPROV);	

CREATE TABLE HOTEL(
	IDHOTEL INT PRIMARY KEY AUTO_INCREMENT,
	NOMEHOTEL VARCHAR(50) NOT NULL,
	CNPJ INT NOT NULL UNIQUE
	);
	
CREATE TABLE HOSPEDAGEM(
	IDHOSP INT PRIMARY KEY AUTO_INCREMENT,
	ID_PASS INT NOT NULL UNIQUE,
	ID_HOTEL INT NOT NULL,
	NUMQUARTO INT NOT NULL
	);
	
ALTER TABLE HOSPEDAGEM
ADD CONSTRAINT FK_HOTEL_HOSPEDAGEM
FOREIGN KEY (ID_HOTEL)
REFERENCES HOTEL(IDHOTEL);

ALTER TABLE HOSPEDAGEM
ADD CONSTRAINT FK_PASSAGEM_HOSPEDAGEM
FOREIGN KEY (ID_PASS)
REFERENCES PASSAGEM(IDPASS);
	
CREATE TABLE COMPANHIAEREA(
	IDCOMP INT PRIMARY KEY AUTO_INCREMENT,
	NOMECOMP VARCHAR(50) NOT NULL,
	CNPJ INT NOT NULL UNIQUE
	);
	
CREATE TABLE AEREA(
	IDAEREA INT PRIMARY KEY AUTO_INCREMENT,
	ID_PASS INT NOT NULL UNIQUE,
	ID_COMP INT NOT NULL,
	LOCALIZADOR INT NOT NULL,
	ASSENTO VARCHAR(5) NOT NULL
	);
	
ALTER TABLE AEREA
ADD CONSTRAINT FK_COMPANHIAREA_AEREA
FOREIGN KEY (ID_COMP)
REFERENCES COMPANHIAEREA(IDCOMP);

ALTER TABLE AEREA
ADD CONSTRAINT FK_PASSAGEM_AEREA
FOREIGN KEY (ID_PASS)
REFERENCES PASSAGEM(IDPASS);

CREATE TABLE LOCADORA(
	IDLOCADORA INT PRIMARY KEY AUTO_INCREMENT,
	NOMELOCADORA VARCHAR(50) NOT NULL,
	CPNJ INT NOT NULL UNIQUE
	);
	
CREATE TABLE LOCACAO(
	IDLOCACAO INT PRIMARY KEY AUTO_INCREMENT,
	ID_PASS INT NOT NULL UNIQUE,
	ID_LOCADORA INT NOT NULL,
	MODELOVEIC VARCHAR(50) NOT NULL,
	PLACA VARCHAR(8) NOT NULL
	);

ALTER TABLE LOCACAO
ADD CONSTRAINT FK_LOCADORA_LOCACAO
FOREIGN KEY (ID_LOCADORA)
REFERENCES LOCADORA(IDLOCADORA);

ALTER TABLE LOCACAO
ADD CONSTRAINT FK_PASSAGEM_LOCACAO
FOREIGN KEY (ID_PASS)
REFERENCES PASSAGEM(IDPASS);

INSERT INTO DEPARTAMENTO VALUES(NULL, 'TI', 5000,NULL);
INSERT INTO FUNCIONARIO VALUES(NULL, 'JOAO', 'JOAO@GMAIL.COM', 'JAOA123',04534625126,1,'SECRETARIO');
INSERT INTO FUNCIONARIO VALUES(NULL, 'GABRIEL', 'GABRIEL@GMAIL.COM', 'GABRIEL123',46889425126,1,'SECRETARIO');

SELECT COUNT(*) FROM FUNCIONARIO
WHERE EMAIL = 'JOAO@GMAIL.COM' AND SENHA = 'JAOA123';

DELIMITER $

CREATE PROCEDURE LOGIN(EMAIL1 VARCHAR(50), SENHA1 VARCHAR(100))
BEGIN
	SELECT COUNT(*) FROM FUNCIONARIO
	WHERE EMAIL = EMAIL1 AND SENHA = SENHA1;
END
$

DELIMITER ;

